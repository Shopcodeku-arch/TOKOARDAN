<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Top Up Roblox - TOKOARDAN</title>
    <link rel="icon" href="https://files.catbox.moe/gyw58d.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- 1. SETUP TEMA --- */
        :root {
            --primary: #3b82f6; --primary-dark: #2563eb; --accent: #facc15;
            --bg-body: #111827; --bg-card: #1f2937;
            --text-main: #f9fafb; --text-sub: #9ca3af;
            --border-color: #374151; --shadow-soft: 0 4px 20px rgba(0,0,0,0.5);
            --error: #ef4444;
        }

        /* --- 2. GLOBAL STYLES & PROTEKSI --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-body); color: var(--text-main); 
            padding-bottom: 120px; min-height: 100vh;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;
        }

        img { pointer-events: none; -webkit-user-drag: none; user-drag: none; -webkit-touch-callout: none; }
        a, button, input, .fs-item, .card-item, details { pointer-events: auto; }

        /* --- 3. HEADER GAME --- */
        .game-header { position: relative; height: 180px; overflow: hidden; border-bottom-left-radius: 20px; border-bottom-right-radius: 20px; box-shadow: var(--shadow-soft); margin-bottom: 20px; }
        .game-bg { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.5); }
        .btn-back { position: absolute; top: 20px; left: 20px; width: 40px; height: 40px; background: rgba(0,0,0,0.4); backdrop-filter: blur(5px); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; cursor: pointer; z-index: 10; font-size: 18px; text-decoration: none; transition: 0.2s; pointer-events: auto; }
        .btn-back:active { transform: scale(0.9); }
        .header-content { position: absolute; bottom: 20px; left: 20px; display: flex; align-items: center; gap: 15px; z-index: 2; }
        .game-icon { width: 65px; height: 65px; border-radius: 16px; border: 2px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .game-text h1 { font-size: 18px; font-weight: 700; margin: 0; text-shadow: 0 2px 4px rgba(0,0,0,0.8); }
        .game-text p { font-size: 12px; opacity: 0.9; margin: 2px 0 5px 0; }
        .badges { display: flex; gap: 8px; }
        .badge { font-size: 9px; background: rgba(0,0,0,0.6); padding: 3px 8px; border-radius: 6px; backdrop-filter: blur(4px); display: flex; align-items: center; gap: 4px; border: 1px solid rgba(255,255,255,0.1); }

        /* --- 4. TABS --- */
        .tab-box { display: flex; background: var(--bg-card); margin: 0 20px 20px; padding: 5px; border-radius: 12px; border: 1px solid var(--border-color); }
        .tab-item { flex: 1; text-align: center; padding: 10px; font-size: 12px; font-weight: 600; color: var(--text-sub); border-radius: 8px; cursor: pointer; transition: 0.3s; pointer-events: auto; }
        .tab-item.active { background: var(--primary); color: white; box-shadow: 0 4px 10px rgba(59, 130, 246, 0.3); }

        /* --- 5. INPUT DATA & HASIL PENCARIAN --- */
        .section-box { background: var(--bg-card); margin: 0 20px 20px; padding: 20px; border-radius: 16px; border: 1px solid var(--border-color); position: relative; box-shadow: var(--shadow-soft); transition: 0.3s; }
        .num-label { position: absolute; top: -12px; left: 0; background: #374151; color: white; font-size: 11px; font-weight: 600; padding: 6px 15px; border-radius: 8px 8px 8px 0; display: flex; align-items: center; gap: 6px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .num-circle { background: var(--primary); width: 18px; height: 18px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; }
        .input-group { display: flex; gap: 10px; margin-top: 10px; position: relative; }
        .input-field { width: 100%; background: var(--bg-body); border: 1px solid var(--border-color); color: var(--text-main); padding: 14px; border-radius: 10px; outline: none; font-size: 13px; transition: 0.3s; pointer-events: auto; user-select: text; -webkit-user-select: text; }
        .input-field:focus { border-color: var(--primary); }
        .helper-text { font-size: 10px; color: var(--text-sub); margin-top: 8px; display: block; margin-left: 2px; }
        
        .input-field.input-error { border-color: var(--error) !important; animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        .user-check-result { display: none; align-items: center; gap: 12px; margin-top: 15px; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--primary); padding: 10px; border-radius: 12px; animation: fadeIn 0.3s; }
        .user-avatar-img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--accent); background: #000; object-fit: cover; }
        .valid-badge { color: var(--accent); font-size: 11px; font-weight: 700; display: flex; align-items: center; gap: 5px; margin-top: 2px; }
        
        .loader-spin { border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--primary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display: none; position: absolute; right: 15px; top: 14px; z-index: 5; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* --- 6. LAYOUT KATEGORI & ITEM --- */
        .cat-title { margin: 0 20px 10px; font-size: 13px; font-weight: 700; display: flex; align-items: center; gap: 8px; color: var(--text-main); }
        .cat-title i { color: var(--accent); }
        .flash-container { margin: 0 20px 25px; border: 1px solid var(--accent); background: rgba(250, 204, 21, 0.05); padding: 15px; border-radius: 16px; position: relative; transition: 0.3s; }
        .flash-header { position: absolute; top: -12px; left: 15px; background: var(--accent); color: #000; font-size: 10px; font-weight: 800; padding: 4px 10px; border-radius: 6px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
        .countdown-badge { background: #ef4444; color: white; padding: 2px 6px; border-radius: 4px; font-family: monospace; font-size: 10px; display: flex; align-items: center; gap: 4px; }
        .flash-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 5px; }
        .fs-item { background: var(--bg-card); padding: 10px; border-radius: 12px; border: 1px solid var(--border-color); display: flex; align-items: center; gap: 12px; cursor: pointer; position: relative; overflow: hidden; transition: 0.2s; pointer-events: auto; }
        .fs-item.selected { border: 2px solid var(--primary); background: rgba(59, 130, 246, 0.1); }
        .fs-img { width: 45px; height: 45px; object-fit: contain; }
        .fs-content { flex: 1; }
        .fs-name { font-size: 12px; font-weight: 600; margin-bottom: 2px; }
        .fs-price { font-size: 13px; font-weight: 700; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .fs-old-price { font-size: 10px; color: var(--text-sub); text-decoration: line-through; font-weight: 400; }
        .fs-stock-bar { height: 4px; background: #374151; border-radius: 2px; margin-top: 6px; position: relative; width: 100%; overflow: hidden; }
        .fs-stock-fill { height: 100%; background: var(--accent); width: 80%; }
        .fs-stock-text { font-size: 9px; color: var(--text-sub); margin-top: 2px; display: flex; justify-content: space-between; }
        
        .normal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 0 20px; margin-bottom: 25px; }
        .card-item { background: var(--bg-card); padding: 12px; border-radius: 12px; border: 1px solid var(--border-color); position: relative; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; pointer-events: auto; }
        .card-item:active { transform: scale(0.98); }
        .card-item.selected { border: 2px solid var(--primary); background: rgba(59, 130, 246, 0.1); }
        .check-mark { position: absolute; top: 0; right: 0; background: var(--primary); color: white; width: 20px; height: 20px; border-bottom-left-radius: 10px; border-top-right-radius: 10px; font-size: 10px; display: none; align-items: center; justify-content: center; }
        .card-item.selected .check-mark { display: flex; }
        .card-img { width: 32px; height: 32px; object-fit: contain; }
        .card-name { font-size: 11px; margin-bottom: 2px; line-height: 1.2; }
        .card-price { font-size: 11px; font-weight: 700; color: var(--primary); }

        /* --- 7. FOOTER & POPUP --- */
        .copyright-text { text-align: center; font-size: 11px; color: var(--text-sub); margin-top: 30px; padding-bottom: 20px; }
        .footer-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--bg-card); border-top: 1px solid var(--border-color); padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; z-index: 99; transform: translateY(100%); transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 -5px 20px rgba(0,0,0,0.2); pointer-events: auto; }
        .footer-bar.show { transform: translateY(0); }
        
        .btn-buy { 
            background: linear-gradient(135deg, var(--accent), #d97706); 
            color: white; border: none; padding: 12px 30px; border-radius: 30px; 
            font-weight: 700; font-size: 13px; cursor: pointer; 
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3); 
            pointer-events: auto; transition: 0.3s;
        }

        /* --- STYLE BARU: Tombol Disabled (Abu-abu) --- */
        .btn-buy:disabled {
            background: #4b5563; /* Abu-abu */
            color: #9ca3af;      /* Teks agak gelap */
            cursor: not-allowed;
            box-shadow: none;
            opacity: 0.7;
            transform: none !important;
        }
        
        #view-keterangan { display: none; padding: 0 20px; animation: fadeIn 0.4s; }
        .info-box { background: var(--bg-card); padding: 20px; border-radius: 16px; border: 1px solid var(--border-color); margin-bottom: 20px; }
        .info-title { font-size: 14px; font-weight: 700; margin-bottom: 15px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .step-list { list-style: none; counter-reset: my-counter; }
        .step-list li { position: relative; padding-left: 30px; margin-bottom: 15px; font-size: 12px; color: var(--text-sub); line-height: 1.6; }
        .step-list li::before { counter-increment: my-counter; content: counter(my-counter); position: absolute; left: 0; top: 0; background: var(--bg-body); border: 1px solid var(--border-color); width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; color: var(--primary); }
        
        details { background: var(--bg-body); border-radius: 10px; padding: 10px 15px; margin-bottom: 10px; border: 1px solid var(--border-color); pointer-events: auto; }
        summary { font-size: 12px; font-weight: 600; cursor: pointer; outline: none; list-style: none; display: flex; justify-content: space-between; align-items: center; }
        summary::after { content: '\f078'; font-family: "Font Awesome 6 Free"; font-weight: 900; font-size: 10px; transition: 0.3s; }
        details[open] summary::after { transform: rotate(180deg); }
        details p { font-size: 11px; color: var(--text-sub); margin-top: 10px; line-height: 1.5; border-top: 1px solid var(--border-color); padding-top: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 999; backdrop-filter: blur(4px); display: none; justify-content: center; align-items: center; }
        .popup { background: var(--bg-card); width: 85%; max-width: 320px; padding: 25px; border-radius: 20px; text-align: center; color: var(--text-main); pointer-events: auto; }
        .btn-group { display: flex; gap: 10px; margin-top: 20px; }
        .btn-yes { flex: 1; background: var(--primary); color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
        .btn-no { flex: 1; background: #ef4444; color: white; border: none; padding: 10px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body oncontextmenu="return false;">
  <div class="overlay" id="confirmPopup">
        <div class="popup">
            <h3 style="font-size:16px;">Konfirmasi Pesanan</h3>
            <p style="font-size:12px; color:var(--text-sub); margin-top:5px;">Lanjutkan pembelian via WhatsApp?</p>
            <div style="background:var(--bg-body); padding:10px; border-radius:10px; margin-top:15px; border:1px solid var(--border-color);">
                <h4 id="confName" style="font-size:13px;">Item Name</h4>
                <div id="confPrice" style="font-size:14px; font-weight:bold; color:var(--primary);">Rp 0</div>
            </div>
            <div class="btn-group">
                <button class="btn-no" onclick="closePopup()">Batal</button>
                <button class="btn-yes" onclick="processOrder()">Lanjut WA</button>
            </div>
        </div>
    </div>

    <div class="game-header">
        <a href="../" class="btn-back"><i class="fa-solid fa-arrow-left"></i></a>
        <img src="https://iili.io/fSntoQ9.md.jpg" class="game-bg">
        <div class="header-content">
            <img src="https://iili.io/fSN5CSs.th.png" class="game-icon">
            <div class="game-text">
                <h1>Roblox</h1>
                <p>Robux & Premium</p>
                <div class="badges">
                    <span class="badge"><i class="fa-solid fa-bolt" style="color:#facc15;"></i> Instant</span>
                    <span class="badge"><i class="fa-solid fa-shield-halved" style="color:#60a5fa;"></i> Aman</span>
                    <span class="badge"><i class="fa-solid fa-circle-check" style="color:#90EE90;"></i> Bergaransi</span>
                </div>
            </div>
        </div>
    </div>

    <div class="tab-box">
        <div class="tab-item active" onclick="switchTab('transaksi')">Transaksi</div>
        <div class="tab-item" onclick="switchTab('keterangan')">Keterangan</div>
    </div>

    <div id="view-transaksi">
        
        <div class="section-box" id="inputSection">
            <div class="num-label"><span class="num-circle">1</span> Masukkan Username</div>
            
            <div class="input-group" style="position:relative;">
                <input type="text" id="userid" class="input-field" placeholder="Masukkan Username Roblox" onkeyup="debounceSearch()" autocomplete="off">
                <div class="loader-spin" id="loadingIcon"></div>
            </div>
            
            <span class="helper-text">Contoh: TokoArdan_Gamer (Tanpa @)</span>

            <div id="userCheckResult" class="user-check-result">
                <img id="robloxAvatar" src="" class="user-avatar-img">
                <div>
                    <div id="robloxName" style="font-size:13px; font-weight:700;">Username</div>
                    <div id="robloxIdDisplay" style="font-size:10px; color:var(--text-sub);">ID: -</div>
                    <div class="valid-badge"><i class="fa-solid fa-circle-check"></i> Terverifikasi</div>
                </div>
            </div>
        </div>

        <div style="margin: 0 20px 20px; position:relative;">
            <div class="num-label" style="position:static; display:inline-flex; width:auto; border-radius:8px;"><span class="num-circle">2</span> Pilih Nominal</div>
        </div>

        <div class="flash-container" id="flashSection">
            <div class="flash-header">
                <span><i class="fa-solid fa-bolt"></i> FLASH SALE</span>
                <div class="countdown-badge" id="countdown">
                    <i class="fa-regular fa-clock"></i> <span id="timer-text">00:00:00</span>
                </div>
            </div>
            <div class="flash-grid" id="flash-list"></div>
        </div>

        <div class="cat-title"><i class="fa-solid fa-gem"></i> Paket Hemat (Fast/ViaLog)</div>
        <div class="normal-grid" id="first-list"></div>

        <div class="cat-title"><i class="fa-solid fa-fire"></i> Premium & Gift (ViaLog/Online/Code)</div>
        <div class="normal-grid" id="special-list"></div>

        <div class="cat-title"><i class="fa-regular fa-gem"></i> Top Up Robux (Pass 1-5 Hari)</div>
        <div class="normal-grid" id="regular-list"></div>
        
        <div class="copyright-text">
            <i class="fa-solid fa-circle-check" style="color:#facc15; margin-right:2px;"></i> <strong>TOKOARDAN All <strong>Rights Reserved<br></strong>
            Made with for Community
        </div>
    </div>

    <div id="view-keterangan">
        <div class="info-box">
            <div class="info-title">Cara Pemesanan</div>
            <ol class="step-list">
                <li>Masukkan <strong>Username Roblox</strong> Anda (Tunggu sampai terverifikasi)</li>
                <li>Pilih nominal Robux yang Anda inginkan</li>
                <li>Klik tombol <strong>"Pesan Sekarang"</strong> di bagian bawah</li>
                <li>Anda akan diarahkan ke <strong>WhatsApp Admin</strong></li>
                <li>Kirim format pesan yang sudah otomatis terisi</li>
            </ol>
        </div>

        <div class="info-box">
            <div class="info-title">FAQ (Tanya Jawab)</div>
            <details>
                <summary>Apa Itu Pass?</summary>
                <p>Pass Roblox adalah item digital (Game Pass) di dalam game Roblox yang memberi keuntungan khusus kepada pemain, seperti akses fitur premium, item eksklusif, kemampuan tambahan, atau membuka area tertentu. Pass hanya bisa digunakan pada game yang mendukungnya dan biasanya bersifat permanen untuk akun pembeli :)</p>
            </details>
            <details>
                <summary>Berapa lama prosesnya?</summary>
                <p>Proses top up biasanya instan (5-10 menit) setelah pembayaran dikonfirmasi :)</p>
            </details>
            <details>
            <summary>Apa Itu ViaLog?</summary>
            <p>ViaLog adalah sistem pengiriman digital yang mencatat dan menampilkan status proses transaksi secara real-time, sehingga pengguna dapat memantau pesanan dari diproses hingga selesai dengan transparan dan aman :)</p>
            </details>
            <details>
            <summary>Takut Kena Scam?</summary>
<p>
Tenang saja, TokoArdan terbebas dari scam dan menyediakan item resmi dari Indonesia :)
<br>
WhatsApp Admin: 
<a href="https://wa.me/6285783123060" target="_blank" style="color:#25D366; text-decoration:none;">
<i class="fa-brands fa-whatsapp"></i> 0857-8312-3060
</a>
</p>
            </details>
            <details>
            <summary>Apa Itu Item Online?</summary>
            <p>Item online adalah item yang akan kami gift/trade lewat map langsung setelah pembayaran terkonfirmasi :)</p>
        </div>
    </div>

    <div class="footer-bar" id="footerBar">
        <div>
            <div style="font-size:10px; color:var(--text-sub);">Total Pembayaran</div>
            <div id="totalPrice" style="font-size:16px; font-weight:bold; color:var(--primary);">Rp 0</div>
        </div>
        <button id="btnBuy" class="btn-buy" onclick="showConfirm()" disabled>Pesan Sekarang</button>
    </div>
    <script>
        // --- PROTEKSI ---
        document.addEventListener('contextmenu', event => event.preventDefault());
        document.addEventListener('dragstart', event => event.preventDefault());

        // --- 1. PENGATURAN FLASH SALE ---
        const targetDate = new Date("2025-01-30 23:59:00").getTime(); 

        function startCountdown() {
            const timerInterval = setInterval(function() {
                const now = new Date().getTime();
                const distance = targetDate - now;
                const flashSection = document.getElementById("flashSection");
                const timerText = document.getElementById("timer-text");

                if (distance < 0) {
                    clearInterval(timerInterval);
                    if(flashSection) flashSection.style.display = "none"; 
                    return; 
                }
                if(flashSection) flashSection.style.display = "block";

                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                if(timerText) {
                    timerText.innerHTML = (hours < 10 ? "0" + hours : hours) + "j " + (minutes < 10 ? "0" + minutes : minutes) + "m " + (seconds < 10 ? "0" + seconds : seconds) + "d";
                }
            }, 1000);
        }
        startCountdown();

        // --- 2. DATA PRODUK ROBLOX ---
        const products = [
            // FLASH SALE
            { id: 1, type: 'flash', name: "400 Robux", price: 65000, oldPrice: 75000, stock: 5, icon: "https://iili.io/fSNTPup.th.png" },
            // PAKET HEMAT
            { id: 3, type: 'first', name: "80 Robux", price: 20000, icon: "https://iili.io/fSNTPup.th.png" },
            { id: 4, type: 'first', name: "800 Robux", price: 190000, icon: "https://iili.io/fSNTPup.th.png" },
            { id: 13, type: 'first', name: "1700 Robux", price: 362000, icon: "https://iili.io/fSNTPup.th.png" },
            { id: 31, type: 'first', name: "4500 Robux", price: 905000, icon: "https://iili.io/fSNTPup.th.png" },
            { id: 32, type: 'first', name: "10000 Robux", price: 1802000, icon: "https://iili.io/fSNTPup.th.png" },
            { id: 33, type: 'first', name: "22500 Robux", price: 3602000, icon: "https://iili.io/fSNTPup.th.png" },
            // PREMIUM
            { id: 5, type: 'special', name: "Roblox Premium 450", price: 75000, icon: "https://iili.io/fSNVzns.th.png" },
            { id: 6, type: 'special', name: "Roblox Premium 1000", price: 147000, icon: "https://iili.io/fSNVzns.th.png" },
            { id: 6, type: 'special', name: "Roblox Premium 2200", price: 292000, icon: "https://iili.io/fSNVzns.th.png" },
            { id: 36, type: 'special', name: "Roblox Gift Card 50K",  price: 50000,  icon: "https://iili.io/fSeHWWQ.th.png" },
            { id: 37, type: 'special', name: "Roblox Gift Card 65K",  price: 65000,  icon: "https://iili.io/fSeHWWQ.th.png" },
            { id: 38, type: 'special', name: "Roblox Gift Card 100K", price: 100000, icon: "https://iili.io/fSeHWWQ.th.png" },
            { id: 39, type: 'special', name: "Roblox Gift Card 100K (x2)", price: 200000, icon: "https://iili.io/fSeHWWQ.th.png" },
            { id: 40, type: 'special', name: "Roblox Gift Card 300K", price: 300000, icon: "https://iili.io/fSeHWWQ.th.png" },
            { id: 41, type: 'special', name: "Roblox Gift Card 380K", price: 380000, icon: "https://iili.io/fSeHWWQ.th.png" },
            { id: 42, type: 'special', name: "Roblox Gift Card 500K", price: 500000, icon: "https://iili.io/fSeHWWQ.th.png" },
            { id: 43, type: 'special', name: "Roblox Gift Card 950K", price: 950000, icon: "https://iili.io/fSeHWWQ.th.png" },
            { id: 44, type: 'special', name: "Red Fox - (GaG)", price: 20000, icon: "https://iili.io/fSOshI1.th.png" },
            { id: 45, type: 'special', name: "Moon Cat - (GaG)", price: 20000, icon: "https://iili.io/fSOLZoF.th.png" },
            { id: 46, type: 'special', name: "Chiken Zombie - (GaG)", price: 30000, icon: "https://iili.io/fSOtw9R.th.png" },
            { id: 47, type: 'special', name: "Dragon Fly - (GaG)", price: 100000, icon: "https://iili.io/fSODXs9.th.png" },
            // PASS
            { id: 7, type: 'regular', name: "80 Robux", price: 12000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 8, type: 'regular', name: "100 Robux", price: 14000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 10, type: 'regular', name: "150 Robux", price: 20000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 11, type: 'regular', name: "250 Robux", price: 33000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 12, type: 'regular', name: "350 Robux", price: 44000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 24, type: 'regular', name: "450 Robux", price: 58000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 25, type: 'regular', name: "500 Robux", price: 64000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 26, type: 'regular', name: "700 Robux", price: 90000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 27, type: 'regular', name: "850 Robux", price: 108000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 28, type: 'regular', name: "950 Robux", price: 121000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 29, type: 'regular', name: "1000 Robux", price: 130000, icon: "https://iili.io/fSNhm0J.png" },
            { id: 30, type: 'regular', name: "2500 Robux", price: 315000, icon: "https://iili.io/fSNhm0J.png" },
        ];

        let selectedItem = null;

        // --- 3. LOGIC TABS & RENDER ---
        function switchTab(tabName) {
            document.querySelectorAll('.tab-item').forEach(el => el.classList.remove('active'));
            document.getElementById('view-transaksi').style.display = 'none';
            document.getElementById('view-keterangan').style.display = 'none';

            if(tabName === 'transaksi') {
                document.querySelectorAll('.tab-item')[0].classList.add('active');
                document.getElementById('view-transaksi').style.display = 'block';
                if(selectedItem) document.getElementById('footerBar').classList.add('show');
            } else {
                document.querySelectorAll('.tab-item')[1].classList.add('active');
                document.getElementById('view-keterangan').style.display = 'block';
                document.getElementById('footerBar').classList.remove('show');
            }
        }

        function render() {
            const cFlash = document.getElementById('flash-list');
            const cFirst = document.getElementById('first-list');
            const cSpecial = document.getElementById('special-list');
            const cRegular = document.getElementById('regular-list');

            products.forEach((item, index) => {
                const fmtPrice = "Rp " + item.price.toLocaleString('id-ID');
                
                if (item.type === 'flash') {
                    const fmtOld = "Rp " + item.oldPrice.toLocaleString('id-ID');
                    cFlash.innerHTML += `<div class="fs-item" onclick="selectItem(this, ${index})"><img src="${item.icon}" class="fs-img"><div class="fs-content"><div class="fs-name">${item.name}</div><div class="fs-price">${fmtPrice} <span class="fs-old-price">${fmtOld}</span></div><div class="fs-stock-bar"><div class="fs-stock-fill" style="width:${item.stock}%"></div></div><div class="fs-stock-text"><span>Tersedia</span><span>${item.stock}x</span></div></div><div class="check-mark"><i class="fa-solid fa-check"></i></div></div>`;
                } else {
                    let target = cRegular;
                    if(item.type === 'first') target = cFirst;
                    if(item.type === 'special') target = cSpecial;
                    
                    if(target) {
                         target.innerHTML += `<div class="card-item" onclick="selectItem(this, ${index})"><div class="check-mark"><i class="fa-solid fa-check"></i></div><img src="${item.icon}" class="card-img"><div><div class="card-name">${item.name}</div><div class="card-price">${fmtPrice}</div></div></div>`;
                    }
                }
            });
        }

        // --- UPDATE TOMBOL (Fungsi Baru) ---
        function updateButtonState() {
            const btn = document.getElementById('btnBuy');
            
            // Aktif hanya jika: User Valid DAN Item dipilih
            if (isUserVerified && selectedItem) {
                btn.disabled = false;
                btn.innerText = "Pesan Sekarang";
            } else {
                btn.disabled = true;
                // Ubah teks agar informatif
                if (!selectedItem) btn.innerText = "Pilih Item";
                else if (!isUserVerified) btn.innerText = "Cek Username...";
                else btn.innerText = "Pesan Sekarang";
            }
        }

        function selectItem(element, index) {
            document.querySelectorAll('.fs-item, .card-item').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedItem = products[index];
            document.getElementById('totalPrice').innerText = "Rp " + selectedItem.price.toLocaleString('id-ID');
            document.getElementById('footerBar').classList.add('show');
            
            updateButtonState(); // Cek status tombol
        }

        // --- 4. LOGIC VALIDASI USER (BARU) ---
        let timeout = null;
        let isUserVerified = false; // Status User
        let verifiedUsername = ""; 
        let isLoading = false; 

        function debounceSearch() {
            const inputVal = document.getElementById('userid').value;
            const loader = document.getElementById('loadingIcon');
            const resultBox = document.getElementById('userCheckResult');

            // Reset Status
            isUserVerified = false;
            verifiedUsername = "";
            resultBox.style.display = 'none';
            
            updateButtonState(); // Matikan tombol saat ngetik

            if (inputVal.length < 3) {
                loader.style.display = 'none';
                isLoading = false;
                return;
            }

            isLoading = true;
            loader.style.display = 'block';

            clearTimeout(timeout);
            timeout = setTimeout(() => {
                searchRobloxUser(inputVal);
            }, 1000);
        }

        async function searchRobloxUser(username) {
            const loader = document.getElementById('loadingIcon');
            const resultBox = document.getElementById('userCheckResult');
            const imgEl = document.getElementById('robloxAvatar');
            const nameEl = document.getElementById('robloxName');
            const idEl = document.getElementById('robloxIdDisplay');

            try {
                const targetUrl = `https://users.roblox.com/v1/users/search?keyword=${username}&limit=10`;
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(targetUrl)}`;

                const response = await fetch(proxyUrl);
                const result = await response.json();
                
                if (!result.contents) throw new Error("No Data");
                const dataRoblox = JSON.parse(result.contents);

                if (dataRoblox.data && dataRoblox.data.length > 0) {
                    const user = dataRoblox.data[0];
                    const userId = user.id;
                    const realName = user.name; 
                    const displayName = user.displayName;

                    const thumbUrl = `https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${userId}&size=150x150&format=Png&isCircular=true`;
                    const proxyThumb = `https://api.allorigins.win/get?url=${encodeURIComponent(thumbUrl)}`;
                    
                    const responseThumb = await fetch(proxyThumb);
                    const resultThumb = await responseThumb.json();
                    const dataThumb = JSON.parse(resultThumb.contents);

                    if(dataThumb.data && dataThumb.data.length > 0) {
                        imgEl.src = dataThumb.data[0].imageUrl;
                        nameEl.innerText = displayName; 
                        idEl.innerText = "@" + realName;
                        
                        isUserVerified = true;
                        verifiedUsername = realName;
                        isLoading = false;

                        loader.style.display = 'none';
                        resultBox.style.display = 'flex'; 
                        
                        updateButtonState(); // Cek status tombol
                    }
                } else {
                    isLoading = false;
                    loader.style.display = 'none';
                    updateButtonState();
                }
            } catch (error) {
                console.error("Error:", error);
                isLoading = false;
                loader.style.display = 'none';
                updateButtonState();
            }
        }

        // --- 5. PROSES ORDER DENGAN PROTEKSI ---
        function showConfirm() {
            // Proteksi ganda (meski tombol disabled, tetap dicek)
            if(!isUserVerified || !selectedItem) return;

            document.getElementById('confName').innerText = `Roblox: ${selectedItem.name}`;
            document.getElementById('confPrice').innerText = "Rp " + selectedItem.price.toLocaleString('id-ID');
            document.getElementById('confirmPopup').style.display = 'flex';
        }

        function closePopup() { document.getElementById('confirmPopup').style.display = 'none'; }

        function processOrder() {
            const phone = "6285783123060"; 
            const finalUsername = verifiedUsername ? verifiedUsername : document.getElementById('userid').value;

            const message = `Halo Admin,\nSaya mau order:\n\n*Game:* Roblox\n*Item:* ${selectedItem.name}\n*Harga:* Rp ${selectedItem.price.toLocaleString('id-ID')}\n*Username:* ${finalUsername} (Valid)\n\nMohon diproses.`;
            
            window.open(`https://wa.me/${phone}?text=${encodeURIComponent(message)}`, '_blank');
            closePopup();
        }

        render();
    </script>
</body>
</html>
